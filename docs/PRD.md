# Anki复习助手 - 产品需求文档(PRD)

## 产品信息结构图
```
Anki复习助手
├── 登录页面
│   ├── 微信一键登录按钮   # 主要入口
│   ├── 登录中 loading    # 登录时显示加载动画
│   └── 登录失败提示      # 登录失败时弹出错误提示
├── 今日复习
│   ├── 导航栏
│   │   └── 页面标题     # "今日复习"
│   ├── 新增按钮         # 位于页面右下角，悬浮显示
│   ├── 复习进度条
│   │   ├── 进度显示     # 例如：已完成 5/20
│   │   └── 进度条       # 可视化展示进度
│   ├── 复习卡片区域
│   │   ├── 卡片正面
│   │   │   ├── 标题（知识点）   # 卡片顶部，显示"知识点"
│   │   │   └── 知识点内容       # 卡片下方，动态显示该卡片的知识点内容
│   │   ├── 卡片反面
│   │   │   ├── 标题（答案）     # 卡片顶部，显示"答案"
│   │   │   └── 答案内容         # 卡片下方，动态显示该卡片的答案内容
│   │   └── 编辑卡片按钮     # 卡片右上角，点击弹出编辑卡片页面（复用编辑卡片组件）
│   ├── 复习信息区（卡片下方）
│   │   ├── 已复习次数
│   │   └── 下次复习时间     # 点击可打开日历选择器，手动设置下次复习时间，不影响复习次数和间隔规则
│   ├── 操作按钮区（卡片最下方）
│   │   ├── 忘记按钮     # 重置复习进度，位于左侧
│   │   └── 掌握按钮     # 进入下一复习周期，位于右侧
│   └── 卡片操作
│       ├── 点击翻面     # 点击卡片切换正反面
│       └── 左右滑动     # 左右滑动切换卡片，如果当前卡片处于反面，切换时会自动重置为正面，以保持学习连贯性
├── 卡片库
│   ├── 导航栏
│   │   ├── 页面标题     # "卡片库"
│   │   └── 新增按钮     # 跳转到新增卡片页面
│   ├── 搜索栏
│   │   ├── 搜索框     # 知识点或答案的实时模糊搜索
│   │   └── 清空按钮     # 清除搜索结果
│   └── 卡片列表
│       ├── 列表项
│       │   ├── 知识点     # 主要信息，最多显示2行
│       │   ├── 创建时间     # 次要信息
│       │   ├── 已复习次数     # 进度指标
│       │   └── 下次复习时间     # 计划提示
│       ├── 左滑操作
│       │   ├── 删除     # 需二次确认
│       │   └── 编辑     # 直接弹出编辑卡片页面（复用编辑卡片组件）
│       └── 编辑卡片弹窗     # 点击列表项或编辑按钮弹出（复用编辑卡片组件）
├── 设置
│   ├── 导航栏
│   │   └── 页面标题     # "设置"
│   ├── 复习规则设置
│   │   ├── 标题：复习规则设置
│   │   ├── 说明文字：
│   │   ├── 规则列表：
│   │   │   ├── 最多支持20次复习的间隔设置
│   │   │   ├── 每行显示：第X次复习 | 间隔天数输入框
│   │   │   └── 默认值
│   │   └── 操作按钮：
│   │       ├── 恢复默认：点击后重置为默认间隔规则
│   │       ├── 保存：保存当前设置的间隔规则
│   │       └── 重置：清空所有设置，恢复为默认值
│   ├── 导入数据功能
│   │   ├── 文件选择区域     # 选择CSV文件
│   │   ├── 导入选项设置     # 重复处理方式选择
│   │   ├── 数据预览         # 显示导入数据统计
│   │   ├── 导入进度显示     # 进度条和状态信息
│   │   └── 导入结果展示     # 成功/失败统计
│   └── 账号设置
│       └── 退出登录         # 清除登录状态
├── 新增卡片页面（全局复用）
│   ├── 导航栏
│   │   ├── 返回按钮     # 返回上一页
│   │   ├── 页面标题     # "新增卡片"
│   │   └── 保存按钮     # 保存卡片内容，根据来源不同有不同的保存后行为：
│   │       ├── 从卡片库进入：返回卡片库并更新列表数据
│   │       └── 从今日复习进入：返回今日复习页面并刷新数据
│   └── 创建知识点卡片
│       ├── 知识点输入区  # 最多输入100字
│       └── 答案输入区    # 支持富文本编辑，最多输入500字
└── 编辑卡片页面（全局复用）
    ├── 知识点、答案可编辑表单
    ├── 底部信息区（创建时间、已复习次数、下次复习时间可修改）
    ├── 保存按钮
    └── 删除按钮（需二次确认，操作后自动刷新并关闭弹窗）
```

## 产品功能详情说明

### 1. 登录页面
- 功能说明：
  - 作为应用的入口页面，未登录用户访问时自动展示。
  - 提供"微信一键登录"按钮，用户点击后发起微信授权流程。
  - 登录过程中显示 loading 动画，防止重复点击。
  - 登录失败时弹出错误提示，支持重试。
- 交互说明：
  - 用户点击"微信一键登录"按钮后，按钮进入 loading 状态，页面其他操作不可用。
  - 登录成功后自动跳转到主页面（今日复习）。
  - 登录失败时弹窗提示"登录失败，请重试"，并恢复按钮可用状态。
  - 支持微信授权流程和开发/测试环境下的快捷登录。
- UI要素：
  - 居中显示应用 logo（可选）、欢迎语、"微信一键登录"按钮。
  - 按钮下方可显示 loading 动画或错误提示。

### 2. 今日复习
- 功能说明：展示今日需要复习的内容

#### 2.1 新增按钮
- 位于页面右下角，以悬浮按钮（FAB）的形式展示。
- 点击后，在当前页以内嵌组件的形式显示"新增卡片"表单。
- 保存成功或取消后，表单消失，并自动刷新今日复习数据。

#### 2.2 复习进度条
- 功能说明：在页面顶部，直观显示今日复习任务的完成进度，帮助用户了解剩余任务量。
- UI要素：
  - 进度条：可视化展示已复习卡片占总卡片数量的百分比。
  - 进度文本：显示具体的数字统计，格式为 "进度: X/Y" (X是已完成数，Y是总数)。
- 交互说明：
  - 每次用户完成一张卡片（点击"掌握"或"忘记"），进度条和文本都会实时更新。
  - 复习全部完成后，进度条显示为100%，并可展示"今日任务已完成"的提示。

#### 2.3 复习卡片区域
- 卡片正面：
  - 顶部为"标题（知识点）"，显示当前卡片的知识点标题。
  - 下方为"知识点内容"，展示该卡片的知识点详细内容。
- 卡片反面：
  - 顶部为"标题（答案）"，显示"答案"字样及当前卡片标题。
  - 下方为"答案内容"，展示该卡片的答案详细内容。
- 点击卡片可切换正反面。
- 左右滑动可切换不同卡片，切换时自动重置为正面。

#### 2.4 复习信息区（卡片下方）
- 已复习次数：展示当前卡片的复习次数，文案为"已复习 x 次"。
- 下次复习时间：使用全局手动调整复习时间组件。

#### 2.5 操作按钮区（卡片最下方）
- 固定在卡片下方，始终可见。
- 左侧为"忘记"按钮：点击后重置当前卡片的复习进度。
- 右侧为"掌握"按钮：点击后将当前卡片推进到下一复习周期。
- 按钮风格现代，间距合理，便于触达。

#### 2.6 卡片操作交互
- 点击卡片任意区域可翻转正反面。
- 左右滑动切换卡片，切换时自动显示正面。
- 操作按钮与卡片内容分离，保证操作区始终可见。

#### 2.7 用户体验优化
- 所有主要操作均可单手完成，按钮区大且易点。
- 信息区与操作区分层清晰，视觉层次分明。
- 空状态时展示美观的图片和提示文案。

#### 2.8 复习规则
- 初始状态：
   - 新卡片复习次数为0
   - 下次复习时间为创建时间
- 掌握按钮：
   - 复习次数加1
   - 根据复习次数计算下次复习时间
   - **复习时间计算优先级**：
     1. 优先使用用户手动设置的 `next_review_at` 作为基准时间
     2. 如果用户没有手动设置，则使用 `first_review_at` 作为基准时间
     3. 如果两个时间都不存在，则使用当前时间作为基准时间
   - 下次复习时间 = 基准时间 + 累计间隔天数
- 忘记按钮：
   - 复习次数重置为0
   - 需要重新开始复习周期
   - 下次复习时间的起点应重置为当前时间

### 3. 卡片库
#### 3.1 导航栏
- 页面标题：显示"卡片库"
- 新增按钮：点击跳转至新增卡片组件

#### 3.2 搜索栏
- 搜索框：支持对知识点和答案内容进行实时模糊搜索
- 清空按钮：一键清除搜索内容，恢复完整卡片列表

#### 3.3 卡片列表
- 列表项展示：
  - 知识点：作为主要信息展示，最多显示2行
  - 创建时间：以次要信息形式展示
  - 已复习次数：直观展示学习进度
  - 下次复习时间：提示用户复习计划，支持点击修改
- 排序规则：
  - 按照下次复习时间的顺序排序，时间越靠前的越排在前面，已过期的卡片会排在最前面
  - 搜索结果也保持相同的排序规则
  - 【补充】卡片库（卡片列表）与复习卡片列表的排序规则完全一致，均按下次复习时间（next_review_at）升序排序，时间越靠前的越排在前面，已过期的卡片会排在最前面。
- 交互功能：
  - 左滑操作：
    - 删除：支持快速删除，设有二次确认防止误操作
    - 编辑：直接弹出编辑卡片组件
  - 点击列表项：进入编辑卡片组件

### 4. 新增卡片组件（全局复用）
#### 4.1 功能说明
- 作为全局复用组件，支持从不同页面进入创建新卡片
- 提供统一的知识点输入和答案输入界面
- 根据来源页面自动调整保存后的行为

#### 4.2 导航栏
- 返回按钮：返回上一页
- 页面标题：显示"新增卡片"
- 保存按钮：保存卡片内容，根据来源不同有不同的保存后行为

#### 4.3 创建知识点卡片
- 知识点输入区：文本输入框，最多输入100字
- 答案输入区：支持富文本编辑，最多输入500字

#### 4.4 保存行为
- 从今日复习页面进入：保存卡片内容后返回今日复习页面，并自动刷新数据以显示新卡片
- 从卡片库进入：保存卡片内容后返回卡片库并更新列表数据

### 5. 编辑卡片页面（全局复用）
#### 5.1 功能说明
- 作为全局复用组件，支持编辑现有卡片的所有信息
- 提供知识点、答案编辑功能
- 支持删除卡片操作

#### 5.2 导航栏
- 返回按钮：返回上一页
- 页面标题：显示"编辑卡片"

#### 5.3 编辑区域
- 知识点编辑：编辑知识点内容，最多100字
- 答案编辑：编辑答案内容，最多500字

#### 5.4 底部信息区
- 以次要信息形式展示
- 创建时间：显示创建时间
- 已复习次数：显示已复习次数
- 下次复习时间：显示复习计划，支持点击修改

#### 5.5 操作按钮
- 保存按钮：保存修改内容并返回上级页面
- 删除按钮：弹出二次确认对话框，确认后删除卡片并返回上级页面

### 6. 下次复习时间（全局复用）
- UI 展示:
  - 显示文案"下次复习时间："
  - 显示相对时间:
    - 距离今天为0天，显示"今天"；1天，显示"明天"；2天，显示"后天"。
    - 3-6天，显示"x天后"；7-27天，显示"x周后"；28-364天，显示"x月后"；365天及以上，显示"x年后"。
    - 若下次复习时间早于今天，则显示"已过期"。
- 交互逻辑:
  - 点击下次复习时间可打开日历选择器
    - 下次复习时间主显示为相对时间，点击后在日历弹窗或下方展示完整日期。
    - 下次复习时间使用特殊样式（蓝色下划线）标注，提示用户可点击
  - 日期选择规则：
    - 可选择任意日期（包括过去日期）
    - 选择过去日期：卡片会立即出现在今日复习列表中
    - 选择未来日期：卡片会在指定日期出现在今日复习列表中
  - 修改下次复习时间不会影响已复习次数
  - 修改下次复习时间不会重置或改变复习间隔规则
  - 修改完成后：
    - 立即更新卡片的下次复习时间
    - 自动刷新当前页面的数据
    - 如果在今日复习页面：
      - 选择未来日期时，该卡片会从今日复习列表中移除
      - 如果还有其他卡片，自动切换到下一张卡片
  - 适用场景：
    - 临时调整学习计划
    - 提前或推迟特定卡片的复习时间
    - 修正之前错误推迟的复习时间
    - 自定义复习时间以适应个人时间安排
  - 全局统一实现：
    - 在以下位置均可通过点击下次复习时间来修改：
      1. 今日复习页面
      2. 卡片库列表页
      3. 卡片详情页
    - 保持一致的交互体验：
      - 统一的可点击样式
      - 统一的日历选择器
      - 统一的数据更新逻辑
  - 日期选择器交互细节：
    - 打开日期选择器时，默认高亮并选中当前卡片的计划复习日期（下次复习时间），而不是今天。
    - 日历中"今天"日期用特殊样式标注，并在日期下方显示"今天"字样。
    - 选中状态与"今天"标注可同时存在，视觉上区分明显。

### 7. 设置
- 导航栏：
  - 页面标题：显示"设置"

#### 7.1 复习间隔设置
- 功能说明：自定义卡片复习间隔规则，控制每次复习后的下次复习时间
- 入口：设置页面 -> 复习间隔规则
- 规则说明：
  - 每次复习后，系统会根据当前复习次数查找对应的间隔天数
  - **基准时间确定规则**：
     1. 优先使用用户手动设置的 `next_review_at` 作为基准时间
     2. 如果用户没有手动设置，则使用 `first_review_at` 作为基准时间
     3. 如果两个时间都不存在，则使用当前时间作为基准时间
  - 下次复习时间 = 基准时间 + 累计间隔天数
  - 累计间隔天数 = 所有已复习次数的间隔天数之和
  - 例如：第1次复习间隔1天，第2次复习间隔2天，则第2次复习后的下次复习时间 = 基准时间 + (1+2)天

- 界面设计：
  - 标题：复习规则设置
  - 说明文字：
    ```
    设置每次复习后的间隔天数。系统会根据复习次数自动计算下次复习时间。
    计算规则：下次复习时间 = 基准时间 + 累计间隔天数
    基准时间优先级：用户手动设置的时间 > 首次复习时间 > 当前时间
    例如：设置第1次间隔1天，第2次间隔2天，则第2次复习后的下次复习时间 = 基准时间 + (1+2)天
    ```
  - 规则列表：
    - 最多支持20次复习的间隔设置
    - 每行显示：第X次复习 | 间隔天数输入框
    - 默认值：
      ```
      第1次：1天
      第2次：1天
      第3次：1天
      第4次：2天
      第5次：3天
      第6次：5天
      第7次：7天
      第8次：7天
      第9次：14天
      第10次：14天
      第11次：30天
      第12次：30天
      第13次：60天
      第14次：60天
      第15次：60天
      第16次：60天
      第17次：60天
      第18次：60天
      第19次：60天
      第20次：60天
      ```
  - 操作按钮：
    - 恢复默认：点击后重置为默认间隔规则
    - 保存：保存当前设置的间隔规则
    - 重置：清空所有设置，恢复为默认值

- 交互说明：
  - 输入限制：
    - 间隔天数必须为正整数
    - 建议范围：1-365天
    - 超出范围时显示提示信息
  - 保存规则：
    - 支持批量修改多条数据
    - 点击保存后立即生效
    - 新规则仅影响后续复习的卡片
    - 已进入复习周期的卡片不受影响
  - 恢复默认：
    - 点击后显示确认对话框
    - 确认后立即恢复默认规则
    - 恢复后需要点击保存才能生效

- 注意事项：
  - 新用户注册时，自动创建默认的间隔时间规则
  - 修改规则不会影响已进入复习周期的卡片
  - 建议根据个人学习能力和记忆特点设置合适的间隔
  - 间隔时间过短可能导致复习压力过大
  - 间隔时间过长可能导致记忆效果下降

#### 7.2 导入数据功能
- 功能说明：支持从外部文件导入卡片数据，方便用户批量添加学习内容
- 入口：设置页面 -> 导入数据
- 支持格式：
  - CSV 文件（UTF-8 编码）
  - 字段顺序要求：
    1. 知识点（必填，最多100字）
    2. 答案（必填，最多500字）
    3. 创建时间（可选，格式：YYYY-MM-DD HH:mm:ss）
    4. 复习次数（可选，默认0）
    5. 下次复习时间（可选，格式：YYYY-MM-DD HH:mm:ss，默认当前时间）

- 界面设计：
  - 标题：导入数据
  - 说明文字：
    ```
    支持导入 CSV 格式的卡片数据。
    文件格式要求：
    - 编码：UTF-8
    - 字段顺序：知识点,答案,创建时间,复习次数,下次复习时间
    - 创建时间、复习次数、下次复习时间为可选字段
    - 时间格式：YYYY-MM-DD HH:mm:ss
    ```
  - 文件选择区域：
    - 文件选择按钮：点击选择本地文件
    - 文件信息显示：显示已选择的文件名和大小
    - 支持格式提示：显示支持的格式（CSV）
     - 导入选项：
     - 重复处理方式：
       - 跳过重复：当知识点和答案都相同时，跳过该卡片
       - 覆盖重复：当知识点和答案都相同时，用导入数据覆盖现有卡片
     - 默认选项：跳过重复
  - 操作按钮：
    - 开始导入：开始处理文件
    - 取消：取消导入操作

- 交互流程：
  1. 用户点击"导入数据"按钮
  2. 显示导入数据页面，包含文件选择和导入选项
  3. 用户选择 CSV 文件
  4. 系统验证文件格式和内容：
     - 检查文件编码是否为 UTF-8
     - 验证 CSV 格式是否正确
     - 检查必填字段是否完整
     - 验证时间格式是否正确
     5. 显示预览信息：
      - 总记录数
      - 有效记录数
      - 重复记录数（知识点和答案都相同的卡片）
      - 错误记录数及错误详情
  6. 用户确认导入选项后点击"开始导入"
  7. 显示导入进度：
     - 进度条显示处理进度
     - 实时显示已处理记录数
     - 显示"取消"按钮，允许用户中断导入
  8. 导入完成后显示结果：
     - 成功导入数量
     - 跳过数量（如有）
     - 错误数量及错误原因
     - 提供"查看详情"按钮查看详细结果

- 错误处理：
  - 文件格式错误：
    - 非 CSV 文件：提示"请选择 CSV 格式的文件"
    - 编码错误：提示"文件编码错误，请使用 UTF-8 编码"
    - 格式错误：提示"CSV 格式错误，请检查文件内容"
  - 数据验证错误：
    - 必填字段为空：显示具体行号和字段名
    - 字段长度超限：显示具体行号和字段名
    - 时间格式错误：显示具体行号和正确格式
  - 网络错误：
    - 上传失败：提示"网络连接失败，请重试"
    - 服务器错误：提示"服务器处理失败，请稍后重试"

- 导入规则：
  - 数据验证：
    - 知识点：必填，长度1-100字
    - 答案：必填，长度1-500字
    - 创建时间：可选，格式为 YYYY-MM-DD HH:mm:ss
    - 复习次数：可选，非负整数，默认0
    - 下次复习时间：可选，格式为 YYYY-MM-DD HH:mm:ss，默认当前时间
  - 字段处理策略：
    - 必填字段：知识点、答案必须存在且不为空
    - 可选字段默认值策略：
      - 创建时间：CSV中为空时使用导入时的当前时间
      - 复习次数：CSV中为空时使用0
      - 下次复习时间：CSV中为空时使用导入时的当前时间
      - 首次复习时间：CSV中为空时保持NULL（只有在用户实际复习时才会设置）
    - 未来扩展字段原则：
      - 业务时间字段（如创建时间）：使用当前时间作为默认值
      - 用户行为时间字段（如首次复习时间）：保持NULL
      - 计数器字段（如复习次数）：使用0作为默认值
      - 描述性文本字段：使用空字符串作为默认值
  - 重复判断：
    - 根据知识点和答案内容同时判断重复（忽略大小写和空格）
    - 只有当知识点和答案都完全相同时，才认为是重复卡片
    - 支持用户选择跳过或覆盖处理方式
  - 批量处理：
    - 支持一次性导入大量数据
    - 分批处理，避免超时
    - 支持导入过程中取消操作

- 注意事项：
  - 导入过程中不可进行其他操作
  - 大量数据导入可能需要较长时间
  - 建议在导入前备份现有数据
  - 导入完成后自动刷新卡片库数据

#### 7.3 导出数据功能
- 导出全部卡片为标准 CSV 文件，UTF-8 编码
- 字段顺序如下：
  1. 知识点
  2. 答案
  3. 创建时间
  4. 复习次数
  5. 下次复习时间

交互流程：
1. 用户点击"导出数据"按钮
2. 显示"处理中..."的 loading 状态，防止重复点击
3. 显示"取消"按钮，用户可主动取消导出任务
4. 后台生成 CSV 文件
5. 生成成功后，显示"导出成功"界面，并提供下载/分享按钮
   - H5端：点击下载按钮，直接下载 CSV 文件
   - 小程序端：将文件保存到本地（需用户授权），也可通过"微信分享"转发文件
6. 导出失败时，显示错误提示，并允许用户重试

#### 7.4 账号设置
- 功能说明：管理用户账号相关设置
- 入口：设置页面 -> 账号设置
- 功能项：
  - 退出登录：
    - 点击后弹出确认对话框
    - 确认后清除登录状态（token）
    - 自动跳转到微信登录页面
    - 取消则保持当前状态

### 8. 用户系统
- 支持微信一键注册/登录
- 用户唯一标识为 openid
- 登录流程：
  1. 前端获取微信 code
  2. 后端通过 code 换取 openid
  3. 查找或创建用户，返回 JWT token
- 用户信息字段：id, openid, nickname, avatar, created_at, updated_at
- 后续所有接口需带 token 鉴权